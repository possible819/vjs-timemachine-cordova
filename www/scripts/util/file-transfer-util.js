class FileTransferUtil{constructor(){let e=navigator.platform.toLowerCase();console.log("TODO: Check Android platform"),this.isMobile=e.indexOf("iphone")>=0,this.isMobile&&document.addEventListener("deviceready",this.storageInitialize.bind(this))}storageInitialize(){if(!("cordova"in window))return;const e=cordova.file.documentsDirectory;let t=this.getFilePath();this.getDirEntry(e).then(e=>{const i=(t=(t=t.startsWith("/")?t.substr(1):t).endsWith("/")?t.slice(0,-1):t).split("/");this.createDir(e,i,0)}).catch(e=>console.error(e))}createDir(e,t,i){e.getDirectory(t[i],{create:!0},e=>{t[++i]&&this.createDir(e,t,i)})}readFiles(e,t){this.isMobile?this.mobileReadFiles(e,t):this.webReadFiles(e,t)}mobileReadFiles(e,t){const i=cordova.file.documentsDirectory,r=i.endsWith("/")?`${i}${e}`:`${i}/${e}`;window.resolveLocalFileSystemURL(r,e=>{e.createReader().readEntries(e=>{t(e)},e=>{throw new Error(e)})})}webReadFiles(e,t){console.log("TODO: create web based logic"),console.log(e,t)}readFile(e,t){this.isMobile?this.mobileReadFile(e,t):this.webReadFile(e,t)}mobileReadFile(e,t){const i=`${cordova.file.documentsDirectory.endsWith("/")?cordova.file.documentsDirectory:cordova.file.documentsDirectory+"/"}${this.getFilePath()}`;this.getDirEntry(i).then(t=>this.getFileEntry(t,e)).then(e=>this.readFileAsText(e)).then(e=>t(e)).catch(e=>console.error(e))}webReadFile(e,t){this.request(this.getReqUrl("read_file"),"POST",{fileName:e,filePath:this.getFilePath()},e=>{t(e.currentTarget.responseText)})}writeFile(e,t){this.isMobile?this.mobileWriteFile(e,t):this.webWriteFile(e,t)}mobileWriteFile(e,t){const i=cordova.file.documentsDirectory.endsWith("/")?cordova.file.documentsDirectory:cordova.file.documentsDirectory+"/",r=this.getFilePath(),s=`${i}${r}`;this.getDirEntry(s).then(t=>this.getFileEntry(t,e)).then(e=>this.createWriter(e)).then(i=>this.writeContent(i,e,r,t)).catch(e=>console.error(e))}webWriteFile(e,t){this.request(this.getReqUrl("write_file"),"POST",{fileName:e,content:t,filePath:this.getFilePath()},e=>{const i=JSON.parse(e.currentTarget.response);document.dispatchEvent(new CustomEvent("write-file-success",{detail:{fileName:i.fileName,filePath:i.filePath,preview:t.split("\n")[0]}}))})}deleteFile(e){this.isMobile?this.mobileDeleteFile(e):this.webDeleteFile(e)}mobileDeleteFile(e){const t=`${cordova.file.documentsDirectory.endsWith("/")?cordova.file.documentsDirectory:cordova.file.documentsDirectory+"/"}${this.getFilePath()}`;this.getDirEntry(t).then(t=>this.getFileEntry(t,e)).then(t=>this.removeFile(t,e)).catch(e=>console.error(e))}webDeleteFile(e){this.request(this.getReqUrl("delete_file"),"POST",{fileName:e,filePath:this.getFilePath()},()=>{const e=JSON.parse(event.currentTarget.response);document.dispatchEvent(new CustomEvent("delete-file-success",{detail:{fileName:e.fileName}}))})}getDirEntry(e){return new Promise((t,i)=>{window.resolveLocalFileSystemURL(e,e=>t(e),e=>i(e))})}getFileEntry(e,t){return new Promise((i,r)=>{e.getFile(t,{create:!0,exclusive:!1},e=>i(e),e=>r(e))})}createWriter(e){return new Promise((t,i)=>{e.createWriter(e=>t(e),e=>i(e))})}writeContent(e,t,i,r){return new Promise((s,o)=>{e.onwriteend=(()=>{document.dispatchEvent(new CustomEvent("write-file-success",{detail:{fileName:t,filePath:i,preview:r.split("\n")[0]}})),s()}),e.onerror=(e=>{document.dispatchEvent(new CustomEvent("write-file-error",{detail:{fileName:t,filePath:i}})),o(e)}),e.write(new Blob([r]),{type:"text/plain"})})}readFileAsText(e){return new Promise((t,i)=>{e.file(e=>{const r=new FileReader;r.onloadend=(()=>{t(r.result)}),r.onerror=(e=>{i(e)}),r.readAsText(e)})})}removeFile(e,t){return new Promise((i,r)=>{e.remove(()=>{document.dispatchEvent(new CustomEvent("delete-file-success",{detail:{fileName:t}})),i()},e=>{r(e)})})}getFilePath(){let e=window.CONST.FILE.PATH;return e.endsWith("/")||(e+="/"),e}getReqUrl(e){let t=window.CONST.SERVER.BASE_URL;return t.endsWith("/")&&(t=t.substr(0,test.length-1)),e.startsWith("/")&&(e=e.substr(1)),`${t}/${e}`}request(e,t,i,r){const s=new XMLHttpRequest;s.open(t,e,!0),t.toLowerCase(),s.setRequestHeader("content-type","application/json"),s.onreadystatechange=(e=>{4===s.readyState&&200===s.status&&r(e)}),i?s.send(JSON.stringify(i)):s.send()}}