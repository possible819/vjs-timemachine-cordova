class SearchUI{constructor(){this.searchViewContainer=document.getElementById("search-view-container")}renderSearchList(e,t){this.clearSearchList();let n=e;n.forEach((e,i)=>{0===i?this.searchViewContainer.appendChild(this.renderDivider(e.year,e.month)):n[i-1].year===e.year&&n[i-1].month===e.month||this.searchViewContainer.appendChild(this.renderDivider(e.year,e.month)),this.searchViewContainer.appendChild(this.renderItemBlock(e.fileName,e.date,e.preview,t))})}clearSearchList(){for(;this.searchViewContainer.childElementCount;)this.searchViewContainer.removeChild(this.searchViewContainer.firstElementChild)}renderDivider(e,t){const n=document.createElement("div");n.classList.add("divide-container");const i=document.createElement("div");i.classList.add("divide-line-container");const d=document.createElement("div");d.classList.add("divide-line-container");const a=document.createElement("div");a.classList.add("divide-line-top");const r=document.createElement("div");r.classList.add("divide-line-bottom");const s=document.createElement("div");s.classList.add("divide-line-top");const c=document.createElement("div");c.classList.add("divide-line-bottom"),i.appendChild(a),i.appendChild(r),d.appendChild(s),d.appendChild(c);const o=document.createElement("span");return o.classList.add("divide-display"),o.innerText=`${e}년 ${t}월`,n.appendChild(i),n.appendChild(o),n.appendChild(d),n}renderItemBlock(e,t,n,i){const d=this.getDayByFileName(e),a=this.renderDateBlock(e,t),r=this.renderDateSection(t,d),s=this.renderContentSection(n,i);return a.appendChild(r),a.appendChild(s),a.addEventListener("touchstart",n=>{const i=this.searchViewContainer.scrollTop;n.currentTarget.timer=setTimeout(()=>{i===this.searchViewContainer.scrollTop&&this.showDeleteAlert(e,t)},500)}),a.addEventListener("touchend",e=>{e.currentTarget.timer&&clearTimeout(e.currentTarget.timer)}),a}showDeleteAlert(e,t){navigator.vibrate(100),window.ha.openConfirm({title:"일기 삭제",type:CONST.NATIVE_STYLE.ALERT.ACTION,message:"일기를 삭제하시겠습니까?",options:[{name:"삭제",type:CONST.NATIVE_STYLE.BTN.DESTRUCTIVE,callback:()=>{e=`${e.substr(0,e.lastIndexOf("-"))}-${t}`,document.dispatchEvent(new CustomEvent("delete-diary",{detail:{fileName:`${e}.txt`,callback:()=>{document.dispatchEvent(new CustomEvent("search-keyword-changed"))}}}))}},{name:"취소",type:CONST.NATIVE_STYLE.BTN.CANCEL}]})}renderDateBlock(e,t){const n=document.createElement("div");return n.classList.add("list-item"),n.setAttribute("date",t),n.addEventListener("click",n=>{window.stdDateUtil.setDate(t),document.dispatchEvent(new CustomEvent("show-content-editor",{detail:{fileName:e,diary:n}}))}),n}renderDateSection(e,t){const n=document.createElement("div");n.classList.add("date-section");const i=document.createElement("span");i.classList.add("date"),i.innerText=e;const d=document.createElement("span");return d.innerText=t,d.classList.add("day"),n.appendChild(i),n.appendChild(d),"일"===t&&n.classList.add("sunday"),n}renderContentSection(e,t){const n=document.createElement("div");n.classList.add("content-section");const i=document.createElement("div");return i.classList.add("content"),i.innerHTML=this.getMarkedPreview(e,t),n.appendChild(i),n}getDayByFileName(e){const t=e.replace(".txt","").split("-");t.forEach((e,n)=>{n>0&&1===e.length&&(t[n]="0"+e)});const n=t.join("-");return["일","월","화","수","목","금","토"][new Date(n).getDay()]}getMarkedPreview(e,t){return t.forEach(t=>{e=e.split(t).join(`<strong>${t}</strong>`)}),e}}