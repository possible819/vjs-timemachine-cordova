class ListUI{constructor(){this.listViewContainer=document.getElementById("list-view-container"),this.prevList=document.getElementById("prev-list"),this.list=document.getElementById("list"),this.nextList=document.getElementById("next-list"),this.addEventListeners(),this.prevPullPoint=document.getElementById("prev-pull-point"),this.nextPullPoint=document.getElementById("next-pull-point")}addEventListeners(){this.listViewContainer.addEventListener("touchstart",t=>{const e=t.touches[0].pageX,i=t.currentTarget.clientWidth,s=5*i/100,n=e>=0&&e<=s||e>=i-s&&e<=i;this._listMovable(n)}),this.listViewContainer.addEventListener("touchend",()=>{if(this.listViewContainer.scrollLeft===window.scroll.availWidth||this.listViewContainer.scrollLeft===this.listViewContainer.clientWidth)return;this._listMovable(!1);const t=window.screen.availWidth,e=t/3;t-e>=this.listViewContainer.scrollLeft?this.adjustPrevListAnimation():t+e<=this.listViewContainer.scrollLeft?this.adjustNextListAnimation():this.adjustSnapBackListAnimation()})}_listMovable(t){this.list.style.overflowY=t?"hidden":"auto"}clearList(t){Array.from(t.querySelectorAll("div.list-item")).forEach(t=>{t.remove()})}renderLists(){this.renderList(),this.renderPrevList(),this.renderNextList(),this.adjustScrollToCenter()}renderList(){this.clearList(this.list),this.renderDateBlocks(window.stdDateUtil.getLastDate(),window.stdDateUtil.getFirstDay(),this.list,window.stdDateUtil.date),this.list.classList.add("list")}renderPrevList(){const t=new DateUtil(window.stdDateUtil.date);t.date.setMonth(t.date.getMonth()-1),this.prevDateUtil=t,this.clearList(this.prevList),this.renderDateBlocks(this.prevDateUtil.getLastDate(),this.prevDateUtil.getFirstDay(),this.prevList),this.prevList.classList.add("list")}renderNextList(){const t=new DateUtil(window.stdDateUtil.date);t.date.setMonth(t.date.getMonth()+1),this.nextDateUtil=t,this.clearList(this.nextList),this.renderDateBlocks(this.nextDateUtil.getLastDate(),this.nextDateUtil.getFirstDay(),this.nextList),this.nextList.classList.add("list")}renderDateBlocks(t,e,i,s){for(let n=1;n<=t;n++){const t=this.renderDateBlock(n);if(s){const e=`${s.getFullYear()}-${s.getMonth()+1}-${n}`,i=new Date;e===`${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}`&&t.classList.add("today")}const a=this.renderDateSection(n,e),r=this.renderContentSection(n);t.appendChild(a),t.appendChild(r),i.appendChild(t)}}adjustScrollToCenter(){this.listViewContainer.scrollLeft=this.listViewContainer.clientWidth}adjustPrevListAnimation(){window.scroller.scrollAnimate(this.listViewContainer,{axis:"x",to:0,duration:15,callback:()=>{this.switchPrevCurrent()}})}adjustNextListAnimation(){window.scroller.scrollAnimate(this.listViewContainer,{axis:"x",to:2*this.listViewContainer.offsetWidth,duration:15,callback:()=>{this.switchNextCurrent()}})}adjustSnapBackListAnimation(){window.scroller.scrollAnimate(this.listViewContainer,{axis:"x",to:this.listViewContainer.offsetWidth,duration:15})}switchPrevCurrent(){this.nextList.remove(),this.list.setAttribute("id","next-list"),this.nextList=this.list,this.prevList.setAttribute("id","list"),this.list=this.prevList,this.nextDateUtil=window.stdDateUtil,window.stdDateUtil=this.prevDateUtil,this.prevList=document.createElement("div"),this.prevList.setAttribute("id","prev-list"),this.listViewContainer.insertBefore(this.prevList,this.listViewContainer.firstElementChild),this.listViewContainer.scrollLeft=window.screen.availWidth,this.renderPrevList(),this.fireCalendarChangeEvent()}switchNextCurrent(){this.prevList.remove(),this.list.setAttribute("id","prev-list"),this.prevList=this.list,this.nextList.setAttribute("id","list"),this.list=this.nextList,this.prevDateUtil=window.stdDateUtil,window.stdDateUtil=this.nextDateUtil,this.nextList=document.createElement("div"),this.nextList.setAttribute("id","next-list"),this.listViewContainer.appendChild(this.nextList),this.listViewContainer.scrollLeft=window.screen.availWidth,this.renderNextList(),this.fireCalendarChangeEvent()}renderDateBlock(t){const e=document.createElement("div");return e.classList.add("list-item"),e.setAttribute("date",t),e.selectDiary=(()=>{const t=e.getAttribute("date"),i=window.stdDateUtil.getDateObj(),s=`${i.year}-${i.month}-${t}.txt`;document.dispatchEvent(new CustomEvent("show-list-preview",{detail:{fileName:s,dateBlock:e}}))}),e.addEventListener("touchstart",t=>{const i=this.listViewContainer.scrollTop;t.currentTarget.timer=setTimeout(()=>{i===this.listViewContainer.scrollTop&&e.hasAttribute("assigned")&&this.showDeleteAlert(e.getAttribute("date"))},500)}),e.addEventListener("touchend",t=>{t.currentTarget.timer&&clearTimeout(t.currentTarget.timer)}),e.showDiaryPreview=(t=>{e.querySelector(".content-field").innerText=t.preview}),e}showDeleteAlert(t){navigator.vibrate(100),window.ha.openConfirm({title:"일기 삭제",type:CONST.NATIVE_STYLE.ALERT.ACTION,message:"일기를 삭제하시겠습니까?",options:[{name:"삭제",type:CONST.NATIVE_STYLE.BTN.DESTRUCTIVE,callback:()=>{let e=window.stdDateUtil.getDateFileNameFormat();e=`${e.substr(0,e.lastIndexOf("-"))}-${t}`,document.dispatchEvent(new CustomEvent("delete-diary",{detail:{fileName:`${e}.txt`}}))}},{name:"취소",type:CONST.NATIVE_STYLE.BTN.CANCEL}]})}adjustAnimation(){let t=2*document.querySelector(".list-item").clientHeight;this.listViewContainer.scrollTop<-t?(window.stdDateUtil.date.setMonth(window.stdDateUtil.date.getMonth()-1),setTimeout(()=>{this.renderLists(),this.fireCalendarChangeEvent()},500)):this.listViewContainer.scrollTop+this.listViewContainer.clientHeight>this.listViewContainer.scrollHeight+t&&(window.stdDateUtil.date.setMonth(window.stdDateUtil.date.getMonth()+1),setTimeout(()=>{this.renderLists(),this.fireCalendarChangeEvent()},500))}showSpinner(t){window.spinner.show({message:t})}hideSpinner(){window.spinner.hide()}fireCalendarChangeEvent(){document.dispatchEvent(new CustomEvent("date-switched"))}renderDateSection(t,e){const i=(e+t-1)%7,s=["일요일","월요일","화요일","수요일","목요일","금요일","토요일"][i],n=document.createElement("div");n.classList.add("date-section");const a=document.createElement("span");a.classList.add("date"),a.innerText=t;const r=document.createElement("span");return r.innerText=s,r.classList.add("day"),n.appendChild(a),n.appendChild(r),0===i&&n.classList.add("sunday"),n}renderContentSection(t){const e=document.createElement("div");e.classList.add("content-section");const i=document.createElement("div");return i.classList.add("content"),i.setAttribute("date",t),i.appendChild(this.getContentField(t)),i.appendChild(this.getAddBtn(t)),e.appendChild(i),e.addEventListener("click",t=>{const e=t.currentTarget.parentElement;window.currentDateUtil=window.stdDateUtil,window.currentDateUtil.setDate(e.getAttribute("date"));const i=`${window.currentDateUtil.getDateFileNameFormat()}.txt`;e.hasAttribute("assigned")?document.dispatchEvent(new CustomEvent("show-content-editor",{detail:{fileName:i}})):document.dispatchEvent(new CustomEvent("show-empty-editor",{detail:{fileName:i}}))}),e}deleteDiary(){window.ha.openConfirm({title:"일기 삭제",type:CONST.NATIVE_STYLE.ALERT.ACTION,message:"일기를 삭제 하시겠습니까?",options:[{name:"취소",type:CONST.NATIVE_STYLE.BTN.CANCEL},{name:"확인",type:CONST.NATIVE_STYLE.BTN.DEFAULT,callback:()=>{document.dispatchEvent(new CustomEvent("delete-diary",{detail:{fileName:`${window.stdDateUtil.getDateFileNameFormat()}.txt`}}))}}]})}getContentField(t){const e=document.createElement("div");return e.setAttribute("date",t),e.classList.add("content-field"),e}getAddBtn(t){const e=document.createElement("img");return e.setAttribute("date",t),e.setAttribute("src","./assets/images/gray-plus.svg"),e.classList.add("add-btn"),e}markAssigneByDates(t){this.clearAssignedDates(),t&&t.length&&t.forEach(t=>{const e=this.getListByDate(t);e.setAttribute("assigned",""),e.selectDiary()})}clearAssignedDates(){Array.from(this.listViewContainer.querySelectorAll("div.list-item[assigned]")).forEach(t=>{t.removeAttribute("assigned")})}getListByDate(t){return this.list.querySelector(`div.list-item[date='${t}']`)}scrollToTop(){window.scroller.scrollAnimate(this.listViewContainer,{axis:"y",to:0,duration:10})}}